# Peer.js 聊天应用

一个基于Peer.js的实时P2P聊天应用，支持两个用户之间的直接通信，无需服务器中转消息。

## 功能特性

- 🔗 **P2P连接**: 基于WebRTC的点对点连接，无需服务器中转
- 💬 **实时聊天**: 即时消息传输，延迟极低，支持时间戳显示
- 😊 **表情包支持**: 丰富的表情符号，支持点击插入
- 📎 **文件传输**: 支持图片、文档、视频、音频等多种文件格式传输
- 🖼️ **图片预览**: 点击图片可全屏预览，支持下载原图
- 🎥 **媒体预览**: 视频和音频文件支持直接播放预览
- 🏠 **同网络优化**: 自动检测同网络连接，提供更快的传输速度
- 📱 **移动端适配**: 完全响应式设计，优化移动设备体验
- 🎨 **现代化设计**: 渐变气泡、流畅动画、悬停效果
- 🔄 **自动连接**: 通过邀请链接自动连接，无需手动输入ID
- 📋 **邀请链接**: 一键生成分享链接，包含你的Peer ID
- 🔄 **连接状态**: 实时显示连接状态和网络类型
- 📁 **文件拖拽**: 支持拖拽文件到聊天区域发送
- 💬 **空状态提示**: 连接前显示友好提示信息
- 👁️ **智能布局**: 连接后自动隐藏连接部分，最大化聊天空间
- ⚡ **快速部署**: 静态文件，无需后端服务

## 快速开始

### 方法1: 直接打开
1. 在浏览器中直接打开 `index.html` 文件
2. 等待Peer连接初始化完成
3. 复制你的Peer ID
4. 将ID分享给要聊天的人，对方输入你的ID并连接

### 方法2: 使用本地服务器
```bash
# 安装依赖（可选）
npm install

# 启动开发服务器
npm run dev

# 或使用简单HTTP服务器
npm start
```

然后在浏览器中访问 `http://localhost:3000`

## 使用说明

### 方法1: 通过邀请链接（推荐）
1. **创建聊天室**: 在浏览器中打开应用，等待Peer ID生成
2. **生成邀请链接**: 点击"生成邀请链接"按钮，复制链接
3. **分享链接**: 将链接发送给要聊天的人
4. **自动连接**: 对方打开链接后会自动连接到你
5. **开始聊天**: 连接成功后就可以发送消息、表情和文件了

### 方法2: 手动输入ID
1. **获取你的ID**: 页面加载后会自动生成一个唯一的Peer ID
2. **分享ID**: 点击"生成邀请链接"按钮复制你的ID，发送给聊天对象
3. **连接对方**: 在"连接到ID"输入框中输入对方的Peer ID，点击"连接"
4. **开始聊天**: 连接成功后可以在底部输入框发送消息

### 方法3: 测试自动连接
1. 打开应用后，点击"测试自动连接"链接
2. 系统会自动在新窗口中打开一个带有你的Peer ID的链接
3. 两个窗口会自动尝试连接
4. 连接成功后可以在两个窗口之间聊天

## 聊天功能

### 发送消息
1. 连接成功后在底部输入框输入消息
2. 点击发送按钮或按回车键发送
3. 每条消息都会显示发送时间

### 发送表情包
1. 点击消息输入框左侧的 😊 表情按钮
2. 从弹出的表情选择器中选择你喜欢的表情
3. 表情会自动插入到输入框中
4. 点击发送按钮或按回车发送

### 发送文件
1. **方法1**: 点击消息输入框左侧的 📎 文件按钮选择文件
2. **方法2**: 直接拖拽文件到聊天区域
3. 支持图片、文档、视频、音频等多种格式（最大50MB）
4. 图片会直接显示预览，点击可全屏查看
5. 视频和音频文件支持直接播放
6. 其他文件提供下载链接

### 预览图片
1. 点击接收到的图片消息
2. 图片会在全屏模态框中显示
3. 点击右上角 × 关闭预览
4. 点击"下载原图"按钮下载图片

### 智能布局
1. **连接前**: 显示Peer ID输入和连接选项
2. **连接中**: 显示连接状态和进度
3. **连接后**: 自动隐藏连接部分，显示完整的聊天界面
4. **断开连接**: 重新显示连接部分，可以重新连接
5. **平滑动画**: 连接部分的显示/隐藏带有优雅的过渡动画

### 网络优化
- 系统会自动检测是否与对方在同一网络
- 同网络连接会显示 🏠 图标，传输更快
- 远程连接会显示 🌐 图标，传输稳定
- 网络状态显示在页面左上角

**提示**: 邀请链接方式更简单，对方只需点击链接就能自动连接！

## 技术栈

- **前端**: HTML5, CSS3, JavaScript (ES6+)
- **P2P通信**: Peer.js v1.5.2
- **WebRTC**: STUN服务器用于NAT穿透，支持网络检测
- **文件传输**: FileReader API，支持Base64编码传输
- **样式**: Flexbox, Grid, CSS渐变和动画
- **网络检测**: WebRTC Stats API，IP地址分析

## 项目结构

```
peerjs-chat/
├── index.html          # 主页面
├── styles.css          # 样式文件
├── script.js           # 聊天逻辑
├── package.json        # 项目配置
└── README.md          # 使用说明
```

## 常见问题

### Q: 为什么连接失败？
A: 可能的原因：
- 网络防火墙阻止了WebRTC连接
- 对方ID输入错误或链接已过期
- 网络连接不稳定
- 浏览器不支持WebRTC

### Q: 自动连接没有生效？
A: 请检查：
- 邀请链接是否正确复制
- 对方是否在同一网络环境中打开链接
- 浏览器是否阻止了弹窗或自动连接

### Q: 如何在不同网络下连接？
A: 确保两个用户都能访问互联网，Peer.js会自动处理NAT穿透。使用邀请链接方式通常更稳定。

### Q: 邀请链接包含什么信息？
A: 邀请链接包含你的Peer ID，对方打开链接后会自动连接到你。链接格式如：`http://localhost:3000?connect=你的PeerID`

### Q: 支持发送什么类型的文件？
A: 支持发送图片、文档、视频、音频等各种文件类型，单个文件最大支持50MB。图片会直接预览显示并支持全屏查看，视频和音频文件支持直接播放，其他文件提供下载链接。

### Q: 表情包如何使用？
A: 点击消息输入框左侧的 😊 按钮，弹出表情选择器，选择喜欢的表情点击即可插入到输入框中。发送后表情会以更大的尺寸显示。

### Q: 如何知道是否在同网络？
A: 连接建立后，系统会自动检测并在页面左上角显示网络状态。如果显示 🏠 图标表示同网络连接，传输速度更快。

### Q: 文件传输安全吗？
A: 文件通过WebRTC加密传输，只有发送方和接收方能看到内容。建议不要发送敏感或隐私文件。

### Q: 支持群聊吗？
A: 当前版本只支持两个用户之间的点对点聊天。如需群聊需要额外开发。

### Q: 消息安全吗？
A: 消息通过WebRTC加密传输，但建议不要发送敏感信息。

### Q: 如何在移动设备上使用？
A: 应用完全适配移动设备，支持触摸操作。移动端界面会自动调整布局，表情选择器和文件预览都针对触摸进行了优化。

### Q: 如何拖拽发送文件？
A: 连接成功后，将文件直接拖拽到聊天区域，松开鼠标即可发送。拖拽时会显示提示信息。

### Q: 图片预览有什么功能？
A: 点击图片消息可以全屏查看图片，支持下载原图。预览界面有毛玻璃背景效果和流畅的动画。

### Q: 为什么消息有时间戳？
A: 每条消息都会显示发送时间，方便查看聊天记录的时序。发送的消息使用发送时间，接收的消息使用接收时间。

## 开发说明

### 添加新功能
1. 编辑 `script.js` 添加聊天逻辑
2. 修改 `styles.css` 更新界面样式
3. 更新 `index.html` 添加新元素

### 代码规范
- 使用ES6+语法
- 遵循语义化HTML
- CSS使用BEM命名规范
- 注释重要功能代码

## 许可证

MIT License

## 贡献

欢迎提交Issue和Pull Request来改进这个项目！

---

**注意**: 这是一个演示项目，生产环境使用前请考虑添加用户认证、消息持久化等功能。
